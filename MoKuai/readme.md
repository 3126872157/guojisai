## 开发日志

--------------------

+ 8.26

  + 总线舵机驱动

+ 8.27

  + rfid驱动

+ 8.28

  + 找到湖南大学的IMU定位方案的IMU代码
  + 测试了大疆IMU_Task例程，贼漂
  + 搞宇树电机，测试485转ttl模块

+ 8.29

  + 宇树电机真难搞呀

    > 宇树A1电机RS485插口朝上，左到右为GND A B
    >
    > 宇树的RS485口的GND一定要接，要不然影响收发
    >
    > 宇树的485转ttl模块的Tx和Rx就接串口的Tx和Rx不用交叉
    >
    > CubeMX配置串口速率4.8M时提示的偏差2.85%是啥意思？？
    >
    > 移植ZJUI的代码发送数据时，电机有启动的噪声，但是不会动，也返回不了数据
    >
    > 485转ttl模块的DE，RE不能同时使能，所以一分二接这两个就可以了
    >
    > 使用dma双缓冲，空闲中断和发送中断这些可以使代码更优雅

  + 电机能转了

  + c板使用手册pwm上标的C1-C8的引脚是乱起名的，害死我了

  + 电机可以收发数据

+ 8.30

  + 优化电机代码结构，参考了ZJUI轮腿的宇树代码，可以收到正确数据了
  + 数据接收使用数组位操作拼接，可以正常处理数据了
  + 写力矩pid控制，位置环
  
+ 8.31

  + 关于数据接收，可以不用数组位操作拼接，使用ServoComDataV3接收更优雅

  + 关于零位置

    > 因为A1只有单个绝对编码器，是给减速前的转子编码的，减速比为9.1
    >
    > 所以一圈上面零点有9.1个，按弧度表述是每隔0.7就是一个新的区间
    >
    > 看看达妙电机，双编码器太香

  + 完成pid代码，在调参，待改进
  
  + 遇到个很傻逼的问题，cubeMX生成代码后我手改了引脚，结果后面没发现，硬控我很久
  
  + 开了vofa看图像，重定向也要用dma
  
    > 不用dma的话，轮询发送，会收不到a1的信息，或者进入调试模式要按几下run再能跑起来
  
  + 靠单环修改前馈值不行，摩擦力太大了
  
  + 加了双环，解决了内置位置PID咔咔硬转
  
  + 但来回低频振荡，静差大且无法消除
  
    > 速度环低速噪音大（1-5rad/s），需不需要前馈加速度，补偿摩擦力，速度环本身速度也震荡
    >
    > 位置环低频振荡，静差小但无法消除，精度不高
  
+ 9.1

  + 自己写的速度环有正弦波型的振荡，且W噪声很大，LW内置滤波会有抽风

  <img src=".\速度.png" alt="image-20240901112926931" style="zoom: 33%;" />

  + 消除噪音可以自己对速度进行滤波，但消除振荡话应该要摩擦力补偿，搞一个动态的前馈力矩
  + 改用半内置的速度控制，半内置位置控制（23老代码方案）

+ 9.2
  
  + 使用内置的速度环，噪音稍微没那么严重，外套自己写的位置环，不加负载很抖
  + 准备安装好机械臂再调pid
  
+ 9.3

  + 装好了机械臂，扩了下宇树A1电机电源线的位置

  + 舵机设置

    > 通过控制板进行初始设置：设置ID和最大最小角，重新安装中值位置
    >
    > 记录旋转正方向

+ 9.4

  + 添加更多舵机驱动：多读多写

    > 多读有问题：在初始化一次之后，就再也进不了空闲中断，无法再次打开DMA
  >
    > 但是单独测试getServosAngle函数倒没事，和servosMove一起连用就不行了
  
  + 计划添加动作组
  + 整合宇树电机与总线舵机，合成arm
  + 封装舵机驱动
  
+ 9.5

  + 整合进FreeRTOS，一开始动不了，是串口打印函数printf的问题，为啥

  + 实机试验，调整pid

  + 关节电机pid问题

    > 因为有重力力矩，向上向下的前馈力矩需要调整
    >
    > 启动太快，猛地咔一下，可能是因为p太大相应过快导致，看看需不需要缓起
    >
    > 由下往上运动会有大静差

